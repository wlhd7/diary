{% extends "base.html" %}

{% block title %}Titles{% endblock %}

{% block body %}
  <style>
    .title-row{ display:flex; align-items:center; }
    .title-text{ white-space:nowrap; }
    .title-dots{ flex:1; border-bottom:1px dotted #888; margin:0 0.5rem; height:0.6em; }
    .title-tags{ white-space:nowrap; font-size:0.95rem; }
    .title-tags a{ text-decoration:none; color:inherit; }
    /* Make list look tidy */
    .titles-list{ list-style:none; padding:0; margin:0; }
    .titles-list li{ padding:0.4rem 0; }
  </style>
  <div style="margin-bottom:1rem">
    <form method="get" action="{{ url_for('home.title') }}">
      <label for="tag-filter">Filter by tag:</label>
      <select id="tag-filter" name="tag" onchange="this.form.submit()">
        <option value="">All tags</option>
        {% for t in tags %}
          <option value="{{ t.name }}" {% if selected_tag == t.name %}selected{% endif %}>{{ t.name }}</option>
        {% endfor %}
      </select>
      <noscript><button type="submit">Filter</button></noscript>
    </form>
  </div>

  {% if entries %}
    <ul class="titles-list">
      {% for e in entries %}
        <li>
          <div class="title-row">
            <div class="title-text"><a href="{{ url_for('diary.detail', id=e.id) }}">{{ e.title }}</a></div>
            {% if e.tags %}
              <div class="title-dots" aria-hidden="true"></div>
              <div class="title-tags">
                {% for t in e.tags.split(',') %}
                  <a href="{{ url_for('home.preview') }}?tag={{ t|urlencode }}">{{ t }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
      {% if total_pages and total_pages > 1 %}
        <nav aria-label="Pagination" style="margin-top:1rem">
          <div>
            {% set qargs = {} %}
            {% if selected_tag %}
              {% set qargs = qargs.update({'tag': selected_tag}) %}
            {% endif %}
          </div>
          <div>
            {% if page > 1 %}
              <a href="{{ url_for('home.title', tag=selected_tag, page=page-1) }}">&laquo; Prev</a>
            {% else %}
              <span style="color:#999">&laquo; Prev</span>
            {% endif %}
            <span style="margin:0 0.75rem">Page {{ page }} of {{ total_pages }}</span>
            {% if page < total_pages %}
              <a href="{{ url_for('home.title', tag=selected_tag, page=page+1) }}">Next &raquo;</a>
            {% else %}
              <span style="color:#999">Next &raquo;</span>
            {% endif %}
          </div>
        </nav>
      {% endif %}
  {% else %}
    <p>No entries yet.</p>
  {% endif %}

{% endblock %}
